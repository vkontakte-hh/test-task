# Тестовое для аналитика-разработчика

Тест состоит из нескольких заданий, каждое из которых требует выполнения всех предыдущих. Выполните столько заданий, сколько сможете.
Вам предстоит спроектировать схему базы данных, и написать программу на Python, которая при помощи сайта fixer.io отслеживает дневные изменения курсов валют для заданных валютных пар с базов в EUR.
Приложите к решению код, команду для его запуска в OS Linux и файл с набором SQL-запросов для инициализации БД (создания необходимых вам таблиц).

<b>Задание 1<br></b>
Для этого при запуске она должна соединиться с СlickHouse и брать из специальной таблицы в этой базе список выбранных для отслеживания валютных пар (для задания выберете 3 валюты для отслеживания с базов в EUR). Затем для каждой пары программа должна обновить в БД таблицу с подневной статистикой кросс-курсов. В результате успешного запуска программы таблица со статистикой должна содержать все доступные данные с начала 2018-01-01 года и по последний доступный для скачивания день.

Код можно писать в предположении, что ваша программа будет регулярно запускаться по расписанию раз в день

<b>Задание 2<br></b>
Предположим, неограниченное количество запусков может быть пропущено по различным причинам (техобслуживание, неполадки). Адаптируйте вашу программу таким образом, чтобы в таком случае импортировалась вся пропущенная статистика.

<b>Задание 3<br></b>
Создайте вспомогательную таблицу, где для каждой валютной пары будут храниться подневные значения скользящей средней цены за последние 28 дней.
Добавьте код, который будет рассчитывать эти значения после успешного импорта.

# Описание решения

1. Создаем проект в <a href="https://console.cloud.yandex.ru/" targt="_blank">yandex cloud</a>
2. Создаем виртуальную машину
3. Создаем кластер ClickHouse

После чего переходим к настройкам окружения. Я делал это через PuTTY.

Для начала создаем приватный и публичный ключ доступа и указываем публичный ключ при создании экземпляра виртуальной машины.

После того как ВМ создана, подключаемся через PuTTY и обновляем пакеты, команды:

$ sudo apt-get update

$ sudo apt-get upgrade

Проверяем наличие python, git, venv и всех необходимых пакетов. Если чего то не хватает, то устанавливаем.

$ sudo apt-get install python3
$ sudo apt-get install git
и т.д.

Для проверки наличие пакета можно командой:

$ python3 --version

Далее создаем виртуальное окружение:

$ python3 -m venv vkontakte

После создания окружения активировать его можно следующей командой:

$ python3 vkontakte/bin/activate

Команда для деактивации:

$ deactivate

Для запуска кода из репозитория необходимо его перенести в ВМ из Git, для этого клонируем репозиторий, команда:

$ git clone https://github.com/vkontakte-hh/test-task.git

Активируем виртуальное окружение и устанавливаем все необходимые для работы пакеты из файла requirements.txt:

$ pip install --upgrade -r requirements.txt

Устанавливаем ClickHouse на ВМ:

* Указываем репозиторий, с которого будет загружен ClickHouse:

$ sudo apt-add-repository "deb http://repo.yandex.ru/clickhouse/deb/stable/ main/"

* Запускаем процесс установки ClickHouse:

$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv E0C56BD4
$ sudo apt-get update
$ sudo apt-get install clickhouse-client clickhouse-server

* Запускаем ClickHouse:

$	sudo service clickhouse-server start

Команда для запуска консольного клиента:

$ clickhouse-client

Тестовый запрос к ClickHouse:

$ select 1

Если все успешно, вернется 1.

Если при подключении пароль не подошел, проверить его можно командой:

$ sudo nano /etc/clickhouse-server/users.d/default-password.xml






